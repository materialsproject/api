<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mp_api.client.mprester &#8212; mp-api 2022 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=001ecc8c"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for mp_api.client.mprester</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache</span><span class="p">,</span> <span class="n">lru_cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">emmet.core.electronic_structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">BSPathType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">emmet.core.mpid</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPID</span><span class="p">,</span> <span class="n">AlphaID</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">emmet.core.types.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThermoType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">emmet.core.vasp.calc_types</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalcType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.analysis.phase_diagram</span><span class="w"> </span><span class="kn">import</span> <span class="n">PhaseDiagram</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.analysis.pourbaix_diagram</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonEntry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Composition</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Structure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.ion</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ion</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.computed_entries</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComputedStructureEntry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.vasp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chgcar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.symmetry.analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpacegroupAnalyzer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">get</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseRester</span><span class="p">,</span> <span class="n">MPRestError</span><span class="p">,</span> <span class="n">MPRestWarning</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.core._oxygen_evolution</span><span class="w"> </span><span class="kn">import</span> <span class="n">OxygenEvolution</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.core.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">MAPI_CLIENT_SETTINGS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.core.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">LazyImport</span><span class="p">,</span>
    <span class="n">load_json</span><span class="p">,</span>
    <span class="n">validate_api_key</span><span class="p">,</span>
    <span class="n">validate_endpoint</span><span class="p">,</span>
    <span class="n">validate_ids</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">GENERIC_RESTERS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.routes.materials</span><span class="w"> </span><span class="kn">import</span> <span class="n">MATERIALS_RESTERS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client.routes.molecules</span><span class="w"> </span><span class="kn">import</span> <span class="n">MOLECULES_RESTERS</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">emmet.core.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoreTaskDoc</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.analysis.phase_diagram</span><span class="w"> </span><span class="kn">import</span> <span class="n">PDEntry</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.computed_entries</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComputedEntry</span>


<span class="n">DEFAULT_THERMOTYPE_CRITERIA</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;thermo_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GGA_GGA+U&quot;</span><span class="p">]}</span>

<span class="n">RESTER_LAYOUT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;molecules/core&quot;</span><span class="p">:</span> <span class="n">LazyImport</span><span class="p">(</span>
        <span class="s2">&quot;mp_api.client.routes.molecules.molecules.MoleculeRester&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;materials/core&quot;</span><span class="p">:</span> <span class="n">LazyImport</span><span class="p">(</span>
        <span class="s2">&quot;mp_api.client.routes.materials.materials.MaterialsRester&quot;</span>
    <span class="p">),</span>
    <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;materials/</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MATERIALS_RESTERS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;doi&quot;</span><span class="p">}},</span>
    <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;molecules/</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MOLECULES_RESTERS</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">}</span>
<span class="n">GENERIC_RESTERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">MATERIALS_RESTERS</span><span class="p">[</span><span class="s2">&quot;doi&quot;</span><span class="p">],</span>
    <span class="o">**</span><span class="n">GENERIC_RESTERS</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="MPRester">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MPRester</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Access the new Materials Project API.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MPRester.__init__">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">notify_db_version</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">include_user_agent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_document_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mute_progress_bars</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">MAPI_CLIENT_SETTINGS</span><span class="o">.</span><span class="n">MUTE_PROGRESS_BARS</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the MPRester.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            api_key (str): A String API key for accessing the MaterialsProject</span>
<span class="sd">                REST interface. Please obtain your API key at</span>
<span class="sd">                https://next-gen.materialsproject.org/api. If this is None,</span>
<span class="sd">                the code will check if there is a &quot;MP_API_KEY&quot; setting.</span>
<span class="sd">                If so, it will use that environment variable. This makes</span>
<span class="sd">                easier for heavy users to simply add this environment variable to</span>
<span class="sd">                their setups and MPRester can then be called without any arguments.</span>
<span class="sd">            endpoint (str): URL of endpoint to access the MaterialsProject REST</span>
<span class="sd">                interface. Defaults to the standard Materials Project REST</span>
<span class="sd">                address at &quot;https://api.materialsproject.org&quot;, but</span>
<span class="sd">                can be changed to other URLs implementing a similar interface.</span>
<span class="sd">            notify_db_version (bool): If True, the current MP database version will</span>
<span class="sd">                be retrieved and logged locally in the ~/.mprester.log.yaml. If the database</span>
<span class="sd">                version changes, you will be notified. The current database version is</span>
<span class="sd">                also printed on instantiation. These local logs are not sent to</span>
<span class="sd">                materialsproject.org and are not associated with your API key, so be</span>
<span class="sd">                aware that a notification may not be presented if you run MPRester</span>
<span class="sd">                from multiple computing environments.</span>
<span class="sd">            include_user_agent (bool): If True, will include a user agent with the</span>
<span class="sd">                HTTP request including information on pymatgen and system version</span>
<span class="sd">                making the API request. This helps MP support pymatgen users, and</span>
<span class="sd">                is similar to what most web browsers send with each page request.</span>
<span class="sd">                Set to False to disable the user agent.</span>
<span class="sd">            use_document_model: If False, skip the creating the document model and return data</span>
<span class="sd">                as a dictionary. This can be simpler to work with but bypasses data validation</span>
<span class="sd">                and will not give auto-complete for available fields.</span>
<span class="sd">            session: Session object to use. By default (None), the client will create one.</span>
<span class="sd">            headers: Custom headers for localhost connections.</span>
<span class="sd">            mute_progress_bars:  Whether to mute progress bars.</span>
<span class="sd">            **kwargs: access to legacy kwargs that may be in the process of being deprecated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">validate_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">validate_endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span> <span class="ow">or</span> <span class="n">BaseRester</span><span class="o">.</span><span class="n">_create_session</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="n">include_user_agent</span><span class="o">=</span><span class="n">include_user_agent</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include_user_agent</span> <span class="o">=</span> <span class="n">include_user_agent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_document_model</span> <span class="o">=</span> <span class="n">use_document_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mute_progress_bars</span> <span class="o">=</span> <span class="n">mute_progress_bars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contribs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_deprecated_attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;eos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;similarity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tasks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xas&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fermi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grain_boundaries&quot;</span><span class="p">,</span>
            <span class="s2">&quot;substrates&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surface_properties&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phonon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elasticity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thermo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dielectric&quot;</span><span class="p">,</span>
            <span class="s2">&quot;piezoelectric&quot;</span><span class="p">,</span>
            <span class="s2">&quot;magnetism&quot;</span><span class="p">,</span>
            <span class="s2">&quot;summary&quot;</span><span class="p">,</span>
            <span class="s2">&quot;robocrys&quot;</span><span class="p">,</span>
            <span class="s2">&quot;synthesis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;insertion_electrodes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electronic_structure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electronic_structure_bandstructure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electronic_structure_dos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;oxidation_states&quot;</span><span class="p">,</span>
            <span class="s2">&quot;provenance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bonds&quot;</span><span class="p">,</span>
            <span class="s2">&quot;alloys&quot;</span><span class="p">,</span>
            <span class="s2">&quot;absorption&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chemenv&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;monty_decode&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Ignoring `monty_decode`, as it is no longer a supported option in `mp_api`.&quot;</span>
                <span class="s2">&quot;The client by default returns results consistent with `monty_decode=True`.&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">MPRestWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Check if emmet version of server is compatible</span>
        <span class="n">emmet_version</span> <span class="o">=</span> <span class="n">MPRester</span><span class="o">.</span><span class="n">get_emmet_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">emmet_version</span><span class="o">.</span><span class="n">base_version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
            <span class="n">MAPI_CLIENT_SETTINGS</span><span class="o">.</span><span class="n">MIN_EMMET_VERSION</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The installed version of the mp-api client may not be compatible with the API server. &quot;</span>
                <span class="s2">&quot;Please install a previous version if any problems occur.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">notify_db_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This has not yet been implemented.&quot;</span><span class="p">)</span>

        <span class="c1"># Dynamically set rester attributes.</span>
        <span class="c1"># First, materials and molecules top level resters are set.</span>
        <span class="c1"># Nested rested are then setup to be loaded dynamically with custom __getattr__ functions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_resters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">RESTER_LAYOUT</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Instantiate top level molecules and materials resters and set them as attributes</span>
        <span class="n">core_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;molecules/core&quot;</span><span class="p">,</span> <span class="s2">&quot;materials/core&quot;</span><span class="p">]</span>

        <span class="n">core_resters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">rest_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">lazy_rester</span><span class="p">(</span>
                <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
                <span class="n">include_user_agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_include_user_agent</span><span class="p">,</span>
                <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                <span class="n">use_document_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_document_model</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">mute_progress_bars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mute_progress_bars</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">rest_name</span><span class="p">,</span> <span class="n">lazy_rester</span> <span class="ow">in</span> <span class="n">RESTER_LAYOUT</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rest_name</span> <span class="ow">in</span> <span class="n">core_suffix</span>
        <span class="p">}</span>

        <span class="c1"># Set remaining top level resters, or get an attribute-class name mapping</span>

        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">rester</span> <span class="ow">in</span> <span class="n">core_resters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">rester</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">rester</span> <span class="ow">in</span> <span class="n">GENERIC_RESTERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">rester</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">contribs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contribs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">mpcontribs.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_contribs</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                    <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                    <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_contribs</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;mpcontribs-client not installed. &quot;</span>
                    <span class="s2">&quot;Install the package to query MPContribs data, construct pourbaix diagrams, &quot;</span>
                    <span class="s2">&quot;or to compute cohesive energies: &#39;pip install mpcontribs-client&#39;&quot;</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_contribs</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem loading MPContribs client: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contribs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Support for &quot;with&quot; context.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Support for &quot;with&quot; context.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deprecated_attributes</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Accessing </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> data through MPRester.</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> is deprecated. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Please use MPRester.materials.</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s2">&quot;materials&quot;</span><span class="p">),</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> object has no attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dir</span><span class="p">(</span><span class="n">MPRester</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deprecated_attributes</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;materials&quot;</span><span class="p">,</span> <span class="s2">&quot;molecules&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="MPRester.get_task_ids_associated_with_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_task_ids_associated_with_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_task_ids_associated_with_material_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">calc_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CalcType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Task ID values associated with a specific Material ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Material ID</span>
<span class="sd">            calc_types ([CalcType]): If specified, will restrict to a certain task type, e.g. [CalcType.GGA_STATIC]</span>

<span class="sd">        Returns:</span>
<span class="sd">            ([str]): List of Task ID values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">material_ids</span><span class="o">=</span><span class="n">material_id</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;calc_types&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">calculations</span> <span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;calc_types&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">calc_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">task</span>
                <span class="k">for</span> <span class="n">task</span><span class="p">,</span> <span class="n">calc_type</span> <span class="ow">in</span> <span class="n">calculations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">calc_type</span> <span class="ow">in</span> <span class="n">calc_types</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">calculations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="MPRester.get_structure_by_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_structure_by_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure_by_material_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">final</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">conventional_unit_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Structure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Structure corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id (a string,</span>
<span class="sd">                e.g., mp-1234).</span>
<span class="sd">            final (bool): Whether to get the final structure, or the list of initial</span>
<span class="sd">                (pre-relaxation) structures. Defaults to True.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard</span>
<span class="sd">                conventional unit cell for the final or list of initial structures.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Structure object or list of Structure objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span>
            <span class="n">material_id</span><span class="o">=</span><span class="n">material_id</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="n">final</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">conventional_unit_cell</span> <span class="ow">and</span> <span class="n">structure_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
                <span class="n">structure_data</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span>
                    <span class="n">structure_data</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">structure_data</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">structure_data</span>
                <span class="p">]</span>

        <span class="k">return</span> <span class="n">structure_data</span></div>


<div class="viewcode-block" id="MPRester.get_database_version">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_database_version">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_database_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The Materials Project database is periodically updated and has a</span>
<span class="sd">        database version associated with it. When the database is updated,</span>
<span class="sd">        consolidated data (information about &quot;a material&quot;) may and does</span>
<span class="sd">        change, while calculation data about a specific calculation task</span>
<span class="sd">        remains unchanged and available for querying via its task_id.</span>

<span class="sd">        The database version is set as a date in the format YYYY_MM_DD,</span>
<span class="sd">        where &quot;_DD&quot; may be optional. An additional numerical suffix</span>
<span class="sd">        might be added if multiple releases happen on the same day.</span>

<span class="sd">        Returns: database version as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">+</span> <span class="s2">&quot;heartbeat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;db_version&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MPRester.get_emmet_version">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_emmet_version">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="nd">@cache</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_emmet_version</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the latest version emmet-core and emmet-api used in the</span>
<span class="sd">        current API service.</span>

<span class="sd">        Returns: version as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">endpoint</span> <span class="o">+</span> <span class="s2">&quot;heartbeat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">error</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MPRestError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="MPRester.get_material_id_from_task_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_material_id_from_task_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_material_id_from_task_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the current material_id from a given task_id. The</span>
<span class="sd">        material_id should rarely change, and is usually chosen from</span>
<span class="sd">        among the smallest numerical id from the group of task_ids for</span>
<span class="sd">        that material. However, in some circumstances it might change,</span>
<span class="sd">        and this method is useful for finding the new material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            task_id (str): A task id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            material_id (MPID)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">task_ids</span><span class="o">=</span><span class="p">[</span><span class="n">task_id</span><span class="p">],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">material_id</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Multiple documents return for </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">, this should not happen, please report it!&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No material found containing task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">. Please report it if you suspect a task has gone missing.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MPRester.get_material_id_references">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_material_id_references">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_material_id_references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns all references for a material id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): A material id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of BibTeX references ([str])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">provenance</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">material_ids</span><span class="o">=</span><span class="n">material_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;references&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">docs</span> <span class="k">else</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="MPRester.get_material_ids">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_material_ids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_material_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chemsys_formula</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MPID</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all materials ids for a formula or chemsys.</span>

<span class="sd">        Args:</span>
<span class="sd">            chemsys_formula (str, List[str]): A chemical system, list of chemical systems</span>
<span class="sd">            (e.g., Li-Fe-O, Si-*, [Si-O, Li-Fe-P]), or single formula (e.g., Fe2O3, Si*).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of all materials ids ([MPID])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inp_k</span> <span class="o">=</span> <span class="s2">&quot;formula&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys_formula</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys_formula</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">chemsys_formula</span>
        <span class="p">):</span>
            <span class="n">inp_k</span> <span class="o">=</span> <span class="s2">&quot;chemsys&quot;</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="o">**</span><span class="p">{</span><span class="n">inp_k</span><span class="p">:</span> <span class="n">chemsys_formula</span><span class="p">},</span>
                <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_structures">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_structures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_structures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">chemsys_formula</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Structure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of Structures corresponding to a chemical system or formula.</span>

<span class="sd">        Args:</span>
<span class="sd">            chemsys_formula (str, List[str]): A chemical system, list of chemical systems</span>
<span class="sd">                (e.g., Li-Fe-O, Si-*, [Si-O, Li-Fe-P]), or single formula (e.g., Fe2O3, Si*).</span>
<span class="sd">            final (bool): Whether to get the final structure, or the list of initial</span>
<span class="sd">                (pre-relaxation) structures. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Structure objects. ([Structure])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys_formula</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys_formula</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">chemsys_formula</span>
        <span class="p">):</span>
            <span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;chemsys&quot;</span><span class="p">:</span> <span class="n">chemsys_formula</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span> <span class="n">chemsys_formula</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
            <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="o">**</span><span class="n">input_params</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">structures</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="o">**</span><span class="n">input_params</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;initial_structures&quot;</span><span class="p">],</span>
            <span class="p">):</span>
                <span class="n">structures</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;initial_structures&quot;</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">structures</span></div>


<div class="viewcode-block" id="MPRester.find_structure">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.find_structure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_structure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename_or_structure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">ltol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">MAPI_CLIENT_SETTINGS</span><span class="o">.</span><span class="n">LTOL</span><span class="p">,</span>
        <span class="n">stol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">MAPI_CLIENT_SETTINGS</span><span class="o">.</span><span class="n">STOL</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">MAPI_CLIENT_SETTINGS</span><span class="o">.</span><span class="n">ANGLE_TOL</span><span class="p">,</span>
        <span class="n">allow_multiple_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finds matching structures from the Materials Project database.</span>

<span class="sd">        Multiple results may be returned of &quot;similar&quot; structures based on</span>
<span class="sd">        distance using the pymatgen StructureMatcher algorithm, however only</span>
<span class="sd">        a single result should match with the same spacegroup, calculated to the</span>
<span class="sd">        default tolerances.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename_or_structure: filename or Structure object</span>
<span class="sd">            ltol: fractional length tolerance</span>
<span class="sd">            stol: site tolerance</span>
<span class="sd">            angle_tol: angle tolerance in degrees</span>
<span class="sd">            allow_multiple_results: changes return type for either</span>
<span class="sd">            a single material_id or list of material_ids</span>
<span class="sd">        Returns:</span>
<span class="sd">            A matching material_id if one is found or list of results if allow_multiple_results</span>
<span class="sd">            is True</span>
<span class="sd">        Raises:</span>
<span class="sd">            MPRestError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">find_structure</span><span class="p">(</span>
            <span class="n">filename_or_structure</span><span class="p">,</span>
            <span class="n">ltol</span><span class="o">=</span><span class="n">ltol</span><span class="p">,</span>
            <span class="n">stol</span><span class="o">=</span><span class="n">stol</span><span class="p">,</span>
            <span class="n">angle_tol</span><span class="o">=</span><span class="n">angle_tol</span><span class="p">,</span>
            <span class="n">allow_multiple_results</span><span class="o">=</span><span class="n">allow_multiple_results</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_entries">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_entries">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chemsys_formula_mpids</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">compatible_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">property_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">conventional_unit_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">additional_criteria</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ComputedStructureEntry</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of ComputedStructureEntry from a chemical system, or formula, or MPID.</span>

<span class="sd">        This returns ComputedStructureEntries with final structures for all thermo types</span>
<span class="sd">        represented in the database. Each type corresponds to a different mixing scheme</span>
<span class="sd">        (i.e. GGA/GGA+U, GGA/GGA+U/R2SCAN, R2SCAN). By default the thermo_type of the</span>
<span class="sd">        entry is also returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            chemsys_formula_mpids (str, List[str]): A chemical system, list of chemical systems</span>
<span class="sd">                (e.g., Li-Fe-O, Si-*, [Si-O, Li-Fe-P]), formula, list of formulas</span>
<span class="sd">                (e.g., Fe2O3, Si*, [SiO2, BiFeO3]), Materials Project ID, or list of Materials</span>
<span class="sd">                Project IDs (e.g., mp-22526, [mp-22526, mp-149]).</span>
<span class="sd">            compatible_only (bool): Whether to return only &quot;compatible&quot;</span>
<span class="sd">                entries. Compatible entries are entries that have been</span>
<span class="sd">                processed using the MaterialsProject2020Compatibility class,</span>
<span class="sd">                which performs adjustments to allow mixing of GGA and GGA+U</span>
<span class="sd">                calculations for more accurate phase diagrams and reaction</span>
<span class="sd">                energies. This data is obtained from the core &quot;thermo&quot; API endpoint.</span>
<span class="sd">            property_data (list): Specify additional properties to include in</span>
<span class="sd">                entry.data. If None, only default data is included. Should be a subset of</span>
<span class="sd">                input parameters in the &#39;MPRester.thermo.available_fields&#39; list.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard</span>
<span class="sd">                conventional unit cell</span>
<span class="sd">            additional_criteria (dict): Any additional criteria to pass. The keys and values should</span>
<span class="sd">                correspond to proper function inputs to `MPRester.thermo.search`. For instance,</span>
<span class="sd">                if you are only interested in entries on the convex hull, you could pass</span>
<span class="sd">                {&quot;energy_above_hull&quot;: (0.0, 0.0)} or {&quot;is_stable&quot;: True}.</span>
<span class="sd">            kwargs: Used here only to gracefully handle deprecated arguments. All kwargs are ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List ComputedStructureEntry objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;inc_structure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The `inc_structure` argument is deprecated as final structures &quot;</span>
                <span class="s2">&quot;are always included in all returned ComputedStructureEntry objects.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys_formula_mpids</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">chemsys_formula_mpids</span> <span class="o">=</span> <span class="p">[</span><span class="n">chemsys_formula_mpids</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;material_ids&quot;</span><span class="p">:</span> <span class="n">validate_ids</span><span class="p">(</span><span class="n">chemsys_formula_mpids</span><span class="p">)}</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">chemsys_formula_mpids</span><span class="p">):</span>
                <span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;chemsys&quot;</span><span class="p">:</span> <span class="n">chemsys_formula_mpids</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span> <span class="n">chemsys_formula_mpids</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">additional_criteria</span><span class="p">:</span>
            <span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">input_params</span><span class="p">,</span> <span class="o">**</span><span class="n">additional_criteria</span><span class="p">}</span>

        <span class="n">entries</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">ComputedStructureEntry</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="s2">&quot;thermo_type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">property_data</span>
            <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="s2">&quot;thermo_type&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">property_data</span>
        <span class="p">)</span>

        <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="o">**</span><span class="n">input_params</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">entry_list</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entry_list</span><span class="p">:</span>
                <span class="n">entry_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;as_dict&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">entry</span>  <span class="c1"># type: ignore</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">compatible_only</span><span class="p">:</span>
                    <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;energy_adjustments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">property_data</span><span class="p">:</span>
                    <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nb">property</span><span class="p">:</span> <span class="n">doc</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span> <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">property_data</span>
                    <span class="p">}</span>

                <span class="k">if</span> <span class="n">conventional_unit_cell</span><span class="p">:</span>
                    <span class="n">entry_struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">])</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span>
                        <span class="n">entry_struct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
                    <span class="n">site_ratio</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry_struct</span><span class="p">)</span>
                    <span class="n">new_energy</span> <span class="o">=</span> <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">site_ratio</span>

                    <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_energy</span>
                    <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
                    <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

                    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;composition&quot;</span><span class="p">]:</span>
                        <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;composition&quot;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span> <span class="o">*=</span> <span class="n">site_ratio</span>

                    <span class="k">for</span> <span class="n">correction</span> <span class="ow">in</span> <span class="n">entry_dict</span><span class="p">[</span><span class="s2">&quot;energy_adjustments&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;n_atoms&quot;</span> <span class="ow">in</span> <span class="n">correction</span><span class="p">:</span>
                            <span class="n">correction</span><span class="p">[</span><span class="s2">&quot;n_atoms&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">site_ratio</span>

                <span class="c1"># Need to store object to permit de-duplication</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ComputedStructureEntry</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">entry_dict</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_pourbaix_entries">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_pourbaix_entries">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_pourbaix_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chemsys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">ComputedEntry</span> <span class="o">|</span> <span class="n">ComputedStructureEntry</span><span class="p">],</span>
        <span class="n">solid_compat</span><span class="o">=</span><span class="s2">&quot;MaterialsProject2020Compatibility&quot;</span><span class="p">,</span>
        <span class="n">use_gibbs</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">300</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A helper function to get all entries necessary to generate</span>
<span class="sd">        a Pourbaix diagram from the rest interface.</span>

<span class="sd">        Args:</span>
<span class="sd">            chemsys (str or [str] or Computed(Structure)Entry):</span>
<span class="sd">                Chemical system string comprising element</span>
<span class="sd">                symbols separated by dashes, e.g., &quot;Li-Fe-O&quot; or List of element</span>
<span class="sd">                symbols, e.g., [&quot;Li&quot;, &quot;Fe&quot;, &quot;O&quot;].</span>

<span class="sd">                Can also be a list of Computed(Structure)Entry objects to allow</span>
<span class="sd">                for adding extra calculation data to the Pourbaix Diagram.</span>
<span class="sd">                If this is set, the chemsys will be inferred from the entries.</span>
<span class="sd">            solid_compat: Compatibility scheme used to pre-process solid DFT energies prior</span>
<span class="sd">                to applying aqueous energy adjustments. May be passed as a class (e.g.</span>
<span class="sd">                MaterialsProject2020Compatibility) or an instance</span>
<span class="sd">                (e.g., MaterialsProject2020Compatibility()). If None, solid DFT energies</span>
<span class="sd">                are used as-is. Default: MaterialsProject2020Compatibility</span>
<span class="sd">            use_gibbs: Set to 300 (for 300 Kelvin) to use a machine learning model to</span>
<span class="sd">                estimate solid free energy from DFT energy (see GibbsComputedStructureEntry).</span>
<span class="sd">                This can slightly improve the accuracy of the Pourbaix diagram in some</span>
<span class="sd">                cases. Default: None. Note that temperatures other than 300K are not</span>
<span class="sd">                permitted here, because MaterialsProjectAqueousCompatibility corrections,</span>
<span class="sd">                used in Pourbaix diagram construction, are calculated based on 300 K data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># imports are not top-level due to expense</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.analysis.pourbaix_diagram</span><span class="w"> </span><span class="kn">import</span> <span class="n">PourbaixEntry</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.compatibility</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">Compatibility</span><span class="p">,</span>
            <span class="n">MaterialsProject2020Compatibility</span><span class="p">,</span>
            <span class="n">MaterialsProjectAqueousCompatibility</span><span class="p">,</span>
            <span class="n">MaterialsProjectCompatibility</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.computed_entries</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComputedEntry</span>

        <span class="n">thermo_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GGA_GGA+U&quot;</span><span class="p">]</span>
        <span class="n">user_entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ComputedEntry</span> <span class="o">|</span> <span class="n">ComputedStructureEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ComputedEntry</span> <span class="o">|</span> <span class="n">ComputedStructureEntry</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chemsys</span>
        <span class="p">):</span>
            <span class="n">user_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">ce</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">ce</span> <span class="ow">in</span> <span class="n">chemsys</span><span class="p">]</span>

            <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">user_entries</span><span class="p">:</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
            <span class="n">chemsys</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span>

            <span class="n">user_run_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;run_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">user_entries</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;r2scan&quot;</span> <span class="ow">in</span> <span class="n">rt</span> <span class="k">for</span> <span class="n">rt</span> <span class="ow">in</span> <span class="n">user_run_types</span><span class="p">):</span>
                <span class="n">thermo_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GGA_GGA+U_R2SCAN&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">solid_compat</span> <span class="o">==</span> <span class="s2">&quot;MaterialsProjectCompatibility&quot;</span><span class="p">:</span>
            <span class="n">solid_compat</span> <span class="o">=</span> <span class="n">MaterialsProjectCompatibility</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">solid_compat</span> <span class="o">==</span> <span class="s2">&quot;MaterialsProject2020Compatibility&quot;</span><span class="p">:</span>
            <span class="n">solid_compat</span> <span class="o">=</span> <span class="n">MaterialsProject2020Compatibility</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solid_compat</span><span class="p">,</span> <span class="n">Compatibility</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Solid compatibility can only be &#39;MaterialsProjectCompatibility&#39;, &quot;</span>
                <span class="s2">&quot;&#39;MaterialsProject2020Compatibility&#39;, or an instance of a Compatibility class&quot;</span>
            <span class="p">)</span>

        <span class="n">pbx_entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">chemsys</span> <span class="o">=</span> <span class="n">chemsys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="c1"># capitalize and sort the elements</span>
        <span class="n">chemsys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">chemsys</span><span class="p">)</span>

        <span class="c1"># Get ion entries first, because certain ions have reference</span>
        <span class="c1"># solids that aren&#39;t necessarily in the chemsys (Na2SO4)</span>

        <span class="c1"># download the ion reference data from MPContribs</span>
        <span class="n">ion_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ion_reference_data_for_chemsys</span><span class="p">(</span><span class="n">chemsys</span><span class="p">)</span>

        <span class="c1"># build the PhaseDiagram for get_ion_entries</span>
        <span class="n">ion_ref_comps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Ion</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;RefSolid&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">composition</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ion_data</span>
        <span class="p">]</span>
        <span class="n">ion_ref_elts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">elements</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ion_ref_comps</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># TODO - would be great if the commented line below would work</span>
        <span class="c1"># However for some reason you cannot process GibbsComputedStructureEntry with</span>
        <span class="c1"># MaterialsProjectAqueousCompatibility</span>
        <span class="n">ion_ref_entries</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_entries_in_chemsys</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ion_ref_elts</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]),</span>
                <span class="n">additional_criteria</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;thermo_types&quot;</span><span class="p">:</span> <span class="n">thermo_types</span><span class="p">},</span>
                <span class="c1"># use_gibbs=use_gibbs</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">user_entries</span>
        <span class="p">)</span>

        <span class="c1"># suppress the warning about supplying the required energies; they will be calculated from the</span>
        <span class="c1"># entries we get from MPRester</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;You did not provide the required O2 and H2O energies.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">compat</span> <span class="o">=</span> <span class="n">MaterialsProjectAqueousCompatibility</span><span class="p">(</span><span class="n">solid_compat</span><span class="o">=</span><span class="n">solid_compat</span><span class="p">)</span>
        <span class="c1"># suppress the warning about missing oxidation states</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Failed to guess oxidation states.*&quot;</span>
            <span class="p">)</span>
            <span class="n">ion_ref_entries</span> <span class="o">=</span> <span class="n">compat</span><span class="o">.</span><span class="n">process_entries</span><span class="p">(</span><span class="n">ion_ref_entries</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="c1"># TODO - if the commented line above would work, this conditional block</span>
        <span class="c1"># could be removed</span>
        <span class="k">if</span> <span class="n">use_gibbs</span><span class="p">:</span>
            <span class="c1"># replace the entries with GibbsComputedStructureEntry</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.computed_entries</span><span class="w"> </span><span class="kn">import</span> <span class="n">GibbsComputedStructureEntry</span>

            <span class="n">ion_ref_entries</span> <span class="o">=</span> <span class="n">GibbsComputedStructureEntry</span><span class="o">.</span><span class="n">from_entries</span><span class="p">(</span>
                <span class="n">ion_ref_entries</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="n">use_gibbs</span>
            <span class="p">)</span>
        <span class="n">ion_ref_pd</span> <span class="o">=</span> <span class="n">PhaseDiagram</span><span class="p">(</span><span class="n">ion_ref_entries</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="n">ion_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ion_entries</span><span class="p">(</span><span class="n">ion_ref_pd</span><span class="p">,</span> <span class="n">ion_ref_data</span><span class="o">=</span><span class="n">ion_data</span><span class="p">)</span>
        <span class="n">pbx_entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">PourbaixEntry</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ion-</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ion_entries</span><span class="p">)]</span>

        <span class="c1"># Construct the solid pourbaix entries from filtered ion_ref entries</span>
        <span class="n">extra_elts</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">ion_ref_elts</span><span class="p">)</span>
            <span class="o">-</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">chemsys</span><span class="p">}</span>
            <span class="o">-</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">),</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)}</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">ion_ref_entries</span><span class="p">:</span>
            <span class="n">entry_elts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
            <span class="c1"># Ensure no OH chemsys or extraneous elements from ion references</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">entry_elts</span> <span class="o">&lt;=</span> <span class="p">{</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">),</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)}</span>
                <span class="ow">or</span> <span class="n">extra_elts</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">entry_elts</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># Create new computed entry</span>
                <span class="n">form_e</span> <span class="o">=</span> <span class="n">ion_ref_pd</span><span class="o">.</span><span class="n">get_form_energy</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="n">new_entry</span> <span class="o">=</span> <span class="n">ComputedEntry</span><span class="p">(</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="p">,</span> <span class="n">form_e</span><span class="p">,</span> <span class="n">entry_id</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">entry_id</span>
                <span class="p">)</span>
                <span class="n">pbx_entry</span> <span class="o">=</span> <span class="n">PourbaixEntry</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
                <span class="n">pbx_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pbx_entry</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pbx_entries</span></div>


<div class="viewcode-block" id="MPRester.get_ion_reference_data">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_ion_reference_data">[docs]</a>
    <span class="nd">@lru_cache</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ion_reference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download aqueous ion reference data used in the construction of Pourbaix diagrams.</span>

<span class="sd">        Use this method to examine the ion reference data and to add additional</span>
<span class="sd">        ions if desired. The data returned from this method can be passed to</span>
<span class="sd">        get_ion_entries().</span>

<span class="sd">        Data are retrieved from the Aqueous Ion Reference Data project</span>
<span class="sd">        hosted on MPContribs. Refer to that project and its associated documentation</span>
<span class="sd">        for more details about the format and meaning of the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [dict]: Among other data, each record contains 1) the experimental ion  free energy, 2) the</span>
<span class="sd">                formula of the reference solid for the ion, and 3) the experimental free energy of the</span>
<span class="sd">                reference solid. All energies are given in kJ/mol. An example is given below.</span>

<span class="sd">                {&#39;identifier&#39;: &#39;Li[+]&#39;,</span>
<span class="sd">                &#39;formula&#39;: &#39;Li[+]&#39;,</span>
<span class="sd">                &#39;data&#39;: {&#39;charge&#39;: {&#39;display&#39;: &#39;1.0&#39;, &#39;value&#39;: 1.0, &#39;unit&#39;: &#39;&#39;},</span>
<span class="sd">                &#39;G&#39;: {&#39;display&#39;: &#39;-293.71 kJ/mol&#39;, &#39;value&#39;: -293.71, &#39;unit&#39;: &#39;kJ/mol&#39;},</span>
<span class="sd">                &#39;MajElements&#39;: &#39;Li&#39;,</span>
<span class="sd">                &#39;RefSolid&#39;: &#39;Li2O&#39;,</span>
<span class="sd">                &#39;GRefSolid&#39;: {&#39;display&#39;: &#39;-561.2 kJ/mol&#39;, &#39;value&#39;: -561.2, &#39;unit&#39;: &#39;kJ/mol&#39;},</span>
<span class="sd">                &#39;reference&#39;: &#39;H. E. Barner and R. V. Scheuerman, Handbook of thermochemical data for</span>
<span class="sd">                compounds and aqueous species, Wiley, New York (1978)&#39;}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contribs</span><span class="o">.</span><span class="n">query_contributions</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="s2">&quot;ion_ref_data&quot;</span><span class="p">},</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;identifier&quot;</span><span class="p">,</span> <span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">],</span>
            <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;data&quot;</span>
        <span class="p">)</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="MPRester.get_ion_reference_data_for_chemsys">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_ion_reference_data_for_chemsys">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ion_reference_data_for_chemsys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chemsys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download aqueous ion reference data used in the construction of Pourbaix diagrams.</span>

<span class="sd">        Use this method to examine the ion reference data and to add additional</span>
<span class="sd">        ions if desired. The data returned from this method can be passed to</span>
<span class="sd">        get_ion_entries().</span>

<span class="sd">        Data are retrieved from the Aqueous Ion Reference Data project</span>
<span class="sd">        hosted on MPContribs. Refer to that project and its associated documentation</span>
<span class="sd">        for more details about the format and meaning of the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            chemsys (str or [str]): Chemical system string comprising element</span>
<span class="sd">                symbols separated by dashes, e.g., &quot;Li-Fe-O&quot; or List of element</span>
<span class="sd">                symbols, e.g., [&quot;Li&quot;, &quot;Fe&quot;, &quot;O&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            [dict]: Among other data, each record contains 1) the experimental ion  free energy, 2) the</span>
<span class="sd">                formula of the reference solid for the ion, and 3) the experimental free energy of the</span>
<span class="sd">                reference solid. All energies are given in kJ/mol. An example is given below.</span>

<span class="sd">                {&#39;identifier&#39;: &#39;Li[+]&#39;,</span>
<span class="sd">                &#39;formula&#39;: &#39;Li[+]&#39;,</span>
<span class="sd">                &#39;data&#39;: {&#39;charge&#39;: {&#39;display&#39;: &#39;1.0&#39;, &#39;value&#39;: 1.0, &#39;unit&#39;: &#39;&#39;},</span>
<span class="sd">                &#39;G&#39;: {&#39;display&#39;: &#39;-293.71 kJ/mol&#39;, &#39;value&#39;: -293.71, &#39;unit&#39;: &#39;kJ/mol&#39;},</span>
<span class="sd">                &#39;MajElements&#39;: &#39;Li&#39;,</span>
<span class="sd">                &#39;RefSolid&#39;: &#39;Li2O&#39;,</span>
<span class="sd">                &#39;GRefSolid&#39;: {&#39;display&#39;: &#39;-561.2 kJ/mol&#39;, &#39;value&#39;: -561.2, &#39;unit&#39;: &#39;kJ/mol&#39;},</span>
<span class="sd">                &#39;reference&#39;: &#39;H. E. Barner and R. V. Scheuerman, Handbook of thermochemical data for</span>
<span class="sd">                compounds and aqueous species, Wiley, New York (1978)&#39;}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ion_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ion_reference_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemsys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">chemsys</span> <span class="o">=</span> <span class="n">chemsys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ion_data</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;MajElements&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chemsys</span><span class="p">]</span></div>


<div class="viewcode-block" id="MPRester.get_ion_entries">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_ion_entries">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ion_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pd</span><span class="p">:</span> <span class="n">PhaseDiagram</span><span class="p">,</span> <span class="n">ion_ref_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IonEntry</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve IonEntry objects that can be used in the construction of</span>
<span class="sd">        Pourbaix Diagrams. The energies of the IonEntry are calculaterd from</span>
<span class="sd">        the solid energies in the provided Phase Diagram to be</span>
<span class="sd">        consistent with experimental free energies.</span>

<span class="sd">        NOTE! This is an advanced method that assumes detailed understanding</span>
<span class="sd">        of how to construct computational Pourbaix Diagrams. If you just want</span>
<span class="sd">        to build a Pourbaix Diagram using default settings, use get_pourbaix_entries.</span>

<span class="sd">        Args:</span>
<span class="sd">            pd: Solid phase diagram on which to construct IonEntry. Note that this</span>
<span class="sd">                Phase Diagram MUST include O and H in its chemical system. For example,</span>
<span class="sd">                to retrieve IonEntry for Ti, the phase diagram passed here should contain</span>
<span class="sd">                materials in the H-O-Ti chemical system. It is also assumed that solid</span>
<span class="sd">                energies have already been corrected with MaterialsProjectAqueousCompatibility,</span>
<span class="sd">                which is necessary for proper construction of Pourbaix diagrams.</span>
<span class="sd">            ion_ref_data: Aqueous ion reference data. If None (default), the data</span>
<span class="sd">                are downloaded from the Aqueous Ion Reference Data project hosted</span>
<span class="sd">                on MPContribs. To add a custom ionic species, first download</span>
<span class="sd">                data using get_ion_reference_data, then add or customize it with</span>
<span class="sd">                your additional data, and pass the customized list here.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [IonEntry]: IonEntry are similar to PDEntry objects. Their energies</span>
<span class="sd">                are free energies in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># determine the chemsys from the phase diagram</span>
        <span class="n">chemsys</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">elements</span><span class="p">])</span>

        <span class="c1"># raise ValueError if O and H not in chemsys</span>
        <span class="k">if</span> <span class="s2">&quot;O&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chemsys</span> <span class="ow">or</span> <span class="s2">&quot;H&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chemsys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The phase diagram chemical system must contain O and H! Your&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; diagram chemical system is </span><span class="si">{</span><span class="n">chemsys</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ion_ref_data</span><span class="p">:</span>
            <span class="n">ion_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ion_reference_data_for_chemsys</span><span class="p">(</span><span class="n">chemsys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ion_data</span> <span class="o">=</span> <span class="n">ion_ref_data</span>

        <span class="c1"># position the ion energies relative to most stable reference state</span>
        <span class="n">ion_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">i_d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ion_data</span><span class="p">):</span>
            <span class="n">ion</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;formula&quot;</span><span class="p">])</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">e</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">all_entries</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_formula</span> <span class="o">==</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;RefSolid&quot;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">refs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Reference solid not contained in entry list&quot;</span><span class="p">)</span>
            <span class="n">stable_ref</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">energy_per_atom</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">stable_ref</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_reduced_composition_and_factor</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># TODO - need a more robust way to convert units</span>
            <span class="c1"># use pint here?</span>
            <span class="k">if</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;GRefSolid&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">:</span>
                <span class="c1"># convert to eV/formula unit</span>
                <span class="n">ref_solid_energy</span> <span class="o">=</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;GRefSolid&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">96.485</span>
            <span class="k">elif</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;GRefSolid&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MJ/mol&quot;</span><span class="p">:</span>
                <span class="c1"># convert to eV/formula unit</span>
                <span class="n">ref_solid_energy</span> <span class="o">=</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;GRefSolid&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">96485</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Ion reference solid energy has incorrect unit </span><span class="si">{</span><span class="n">i_d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;GRefSolid&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">solid_diff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_form_energy</span><span class="p">(</span><span class="n">stable_ref</span><span class="p">)</span> <span class="o">-</span> <span class="n">ref_solid_energy</span> <span class="o">*</span> <span class="n">rf</span>
            <span class="n">elt</span> <span class="o">=</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;MajElements&quot;</span><span class="p">]</span>
            <span class="n">correction_factor</span> <span class="o">=</span> <span class="n">ion</span><span class="o">.</span><span class="n">composition</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">/</span> <span class="n">stable_ref</span><span class="o">.</span><span class="n">composition</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span>
            <span class="c1"># TODO - need a more robust way to convert units</span>
            <span class="c1"># use pint here?</span>
            <span class="k">if</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;G&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">:</span>
                <span class="c1"># convert to eV/formula unit</span>
                <span class="n">ion_free_energy</span> <span class="o">=</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;G&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">96.485</span>
            <span class="k">elif</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;G&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MJ/mol&quot;</span><span class="p">:</span>
                <span class="c1"># convert to eV/formula unit</span>
                <span class="n">ion_free_energy</span> <span class="o">=</span> <span class="n">i_d</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;G&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">96485</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Ion free energy has incorrect unit </span><span class="si">{</span><span class="n">i_d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;G&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">ion_free_energy</span> <span class="o">+</span> <span class="n">solid_diff</span> <span class="o">*</span> <span class="n">correction_factor</span>
            <span class="n">ion_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IonEntry</span><span class="p">(</span><span class="n">ion</span><span class="p">,</span> <span class="n">energy</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ion_entries</span></div>


<div class="viewcode-block" id="MPRester.get_entry_by_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_entry_by_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry_by_material_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">compatible_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">property_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">conventional_unit_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all ComputedEntry objects corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id (a string,</span>
<span class="sd">                e.g., mp-1234).</span>
<span class="sd">            compatible_only (bool): Whether to return only &quot;compatible&quot;</span>
<span class="sd">                entries. Compatible entries are entries that have been</span>
<span class="sd">                processed using the MaterialsProject2020Compatibility class,</span>
<span class="sd">                which performs adjustments to allow mixing of GGA and GGA+U</span>
<span class="sd">                calculations for more accurate phase diagrams and reaction</span>
<span class="sd">                energies. This data is obtained from the core &quot;thermo&quot; API endpoint.</span>
<span class="sd">            property_data (list): Specify additional properties to include in</span>
<span class="sd">                entry.data. If None, only default data is included. Should be a subset of</span>
<span class="sd">                input parameters in the &#39;MPRester.thermo.available_fields&#39; list.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard</span>
<span class="sd">                conventional unit cell</span>
<span class="sd">            kwargs : Other kwargs to pass to `get_entries`</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of ComputedEntry or ComputedStructureEntry object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(</span>
            <span class="n">material_id</span><span class="p">,</span>
            <span class="n">compatible_only</span><span class="o">=</span><span class="n">compatible_only</span><span class="p">,</span>
            <span class="n">property_data</span><span class="o">=</span><span class="n">property_data</span><span class="p">,</span>
            <span class="n">conventional_unit_cell</span><span class="o">=</span><span class="n">conventional_unit_cell</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_entries_in_chemsys">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_entries_in_chemsys">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_entries_in_chemsys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">use_gibbs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compatible_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">property_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">conventional_unit_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">additional_criteria</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">DEFAULT_THERMOTYPE_CRITERIA</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to get a list of ComputedEntries in a chemical system.</span>
<span class="sd">        For example, elements = [&quot;Li&quot;, &quot;Fe&quot;, &quot;O&quot;] will return a list of all</span>
<span class="sd">        entries in the parent Li-Fe-O chemical system, as well as all subsystems</span>
<span class="sd">        (i.e., all LixOy, FexOy, LixFey, LixFeyOz, Li, Fe and O phases). Extremely</span>
<span class="sd">        useful for creating phase diagrams of entire chemical systems.</span>

<span class="sd">        Note that by default this returns mixed GGA/GGA+U entries. For others,</span>
<span class="sd">        pass GGA/GGA+U/R2SCAN, or R2SCAN as thermo_types in additional_criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            elements (str or [str]): Parent chemical system string comprising element</span>
<span class="sd">                symbols separated by dashes, e.g., &quot;Li-Fe-O&quot; or List of element</span>
<span class="sd">                symbols, e.g., [&quot;Li&quot;, &quot;Fe&quot;, &quot;O&quot;].</span>
<span class="sd">            use_gibbs: If None (default), DFT energy is returned. If a number, return</span>
<span class="sd">                the free energy of formation estimated using a machine learning model</span>
<span class="sd">                (see GibbsComputedStructureEntry). The number is the temperature in</span>
<span class="sd">                Kelvin at which to estimate the free energy. Must be between 300 K and</span>
<span class="sd">                2000 K.</span>
<span class="sd">            compatible_only (bool): Whether to return only &quot;compatible&quot;</span>
<span class="sd">                entries. Compatible entries are entries that have been</span>
<span class="sd">                processed using the MaterialsProject2020Compatibility class,</span>
<span class="sd">                which performs adjustments to allow mixing of GGA and GGA+U</span>
<span class="sd">                calculations for more accurate phase diagrams and reaction</span>
<span class="sd">                energies. This data is obtained from the core &quot;thermo&quot; API endpoint.</span>
<span class="sd">            property_data (list): Specify additional properties to include in</span>
<span class="sd">                entry.data. If None, only default data is included. Should be a subset of</span>
<span class="sd">                input parameters in the &#39;MPRester.thermo.available_fields&#39; list.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard</span>
<span class="sd">                conventional unit cell</span>
<span class="sd">            additional_criteria (dict): Any additional criteria to pass. The keys and values should</span>
<span class="sd">                correspond to proper function inputs to `MPRester.thermo.search`. For instance,</span>
<span class="sd">                if you are only interested in entries on the convex hull, you could pass</span>
<span class="sd">                {&quot;energy_above_hull&quot;: (0.0, 0.0)} or {&quot;is_stable&quot;: True}, or if you are only interested</span>
<span class="sd">                in entry data</span>
<span class="sd">            kwargs : Other kwargs to pass to `get_entries`</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of ComputedStructureEntries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="n">elements_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>  <span class="c1"># remove duplicate elements</span>

        <span class="n">all_chemsyses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">els</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements_set</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">els</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">elements_set</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(</span>
                <span class="n">all_chemsyses</span><span class="p">,</span>
                <span class="n">compatible_only</span><span class="o">=</span><span class="n">compatible_only</span><span class="p">,</span>
                <span class="n">property_data</span><span class="o">=</span><span class="n">property_data</span><span class="p">,</span>
                <span class="n">conventional_unit_cell</span><span class="o">=</span><span class="n">conventional_unit_cell</span><span class="p">,</span>
                <span class="n">additional_criteria</span><span class="o">=</span><span class="n">additional_criteria</span> <span class="ow">or</span> <span class="n">DEFAULT_THERMOTYPE_CRITERIA</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">use_gibbs</span><span class="p">:</span>
            <span class="c1"># replace the entries with GibbsComputedStructureEntry</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.computed_entries</span><span class="w"> </span><span class="kn">import</span> <span class="n">GibbsComputedStructureEntry</span>

            <span class="n">entries</span> <span class="o">=</span> <span class="n">GibbsComputedStructureEntry</span><span class="o">.</span><span class="n">from_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="n">use_gibbs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entries</span></div>


<div class="viewcode-block" id="MPRester.get_bandstructure_by_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_bandstructure_by_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_bandstructure_by_material_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">path_type</span><span class="p">:</span> <span class="n">BSPathType</span> <span class="o">=</span> <span class="n">BSPathType</span><span class="o">.</span><span class="n">setyawan_curtarolo</span><span class="p">,</span>
        <span class="n">line_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the band structure pymatgen object associated with a Materials Project ID.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            material_id (str): Materials Project ID for a material</span>
<span class="sd">            path_type (BSPathType): k-point path selection convention</span>
<span class="sd">            line_mode (bool): Whether to return data for a line-mode calculation</span>

<span class="sd">        Returns:</span>
<span class="sd">            bandstructure (Union[BandStructure, BandStructureSymmLine]): BandStructure or BandStructureSymmLine object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">electronic_structure_bandstructure</span><span class="o">.</span><span class="n">get_bandstructure_from_material_id</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">material_id</span><span class="o">=</span><span class="n">material_id</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">path_type</span><span class="p">,</span> <span class="n">line_mode</span><span class="o">=</span><span class="n">line_mode</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_dos_by_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_dos_by_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dos_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the complete density of states pymatgen object associated with a Materials Project ID.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            material_id (str): Materials Project ID for a material</span>

<span class="sd">        Returns:</span>
<span class="sd">            dos (CompleteDos): CompleteDos object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">electronic_structure_dos</span><span class="o">.</span><span class="n">get_dos_from_material_id</span><span class="p">(</span>
            <span class="n">material_id</span><span class="o">=</span><span class="n">material_id</span>
        <span class="p">)</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="MPRester.get_phonon_dos_by_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_phonon_dos_by_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_phonon_dos_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get phonon density of states data corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id.</span>

<span class="sd">        Returns:</span>
<span class="sd">             CompletePhononDos: A phonon DOS object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">phonon</span><span class="o">.</span><span class="n">get_dos_from_material_id</span><span class="p">(</span>
            <span class="n">material_id</span><span class="o">=</span><span class="n">material_id</span><span class="p">,</span> <span class="n">phonon_method</span><span class="o">=</span><span class="s2">&quot;dfpt&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_phonon_bandstructure_by_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_phonon_bandstructure_by_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_phonon_bandstructure_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get phonon dispersion data corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PhononBandStructureSymmLine:  phonon band structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">phonon</span><span class="o">.</span><span class="n">get_bandstructure_from_material_id</span><span class="p">(</span>
            <span class="n">material_id</span><span class="o">=</span><span class="n">material_id</span><span class="p">,</span> <span class="n">phonon_method</span><span class="o">=</span><span class="s2">&quot;dfpt&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_wulff_shape">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_wulff_shape">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_wulff_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs a Wulff shape for a material.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id, e.g. &#39;mp-123&#39;.</span>


<span class="sd">        Returns:</span>
<span class="sd">            pymatgen.analysis.wulff.WulffShape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.analysis.wulff</span><span class="w"> </span><span class="kn">import</span> <span class="n">WulffShape</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.symmetry.analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpacegroupAnalyzer</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">material_id</span><span class="p">)</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">surface_properties</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">material_ids</span><span class="o">=</span><span class="n">material_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">doc</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">surfaces</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;surfaces&quot;</span><span class="p">]</span>

        <span class="n">lattice</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span><span class="o">.</span><span class="n">lattice</span>
        <span class="p">)</span>
        <span class="n">miller_energy_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>
            <span class="n">miller</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">surf</span><span class="o">.</span><span class="n">miller_index</span><span class="p">)</span> <span class="k">if</span> <span class="n">surf</span><span class="o">.</span><span class="n">miller_index</span> <span class="k">else</span> <span class="p">()</span>
            <span class="c1"># Prefer reconstructed surfaces, which have lower surface energies.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">miller</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">miller_energy_map</span><span class="p">)</span> <span class="ow">or</span> <span class="n">surf</span><span class="o">.</span><span class="n">is_reconstructed</span><span class="p">:</span>
                <span class="n">miller_energy_map</span><span class="p">[</span><span class="n">miller</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">surface_energy</span>
        <span class="n">millers</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">miller_energy_map</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">WulffShape</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">millers</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_charge_density_from_task_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_charge_density_from_task_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_charge_density_from_task_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">inc_task_doc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Chgcar</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Chgcar</span><span class="p">,</span> <span class="n">CoreTaskDoc</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get charge density data for a given task_id.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            task_id (str): A task id</span>
<span class="sd">            inc_task_doc (bool): Whether to include the task document in the returned data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Chgcar, (Chgcar, CoreTaskDoc | dict), None): Pymatgen Chgcar object, or tuple with object and CoreTaskDoc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chgcar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">_query_open_data</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="s2">&quot;materialsproject-parsed&quot;</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chgcars/</span><span class="si">{</span><span class="n">validate_ids</span><span class="p">([</span><span class="n">task_id</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.json.gz&quot;</span><span class="p">,</span>
            <span class="n">decoder</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">load_json</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deser</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">inc_task_doc</span><span class="p">:</span>
            <span class="n">task_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">task_ids</span><span class="o">=</span><span class="n">task_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">chgcar</span><span class="p">,</span> <span class="n">task_doc</span>

        <span class="k">return</span> <span class="n">chgcar</span></div>


<div class="viewcode-block" id="MPRester.get_charge_density_from_material_id">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_charge_density_from_material_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_charge_density_from_material_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">inc_task_doc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Chgcar</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Chgcar</span><span class="p">,</span> <span class="n">CoreTaskDoc</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get charge density data for a given Materials Project ID.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            material_id (str): Material Project ID</span>
<span class="sd">            inc_task_doc (bool): Whether to include the task document in the returned data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Chgcar, (Chgcar, CoreTaskDoc | dict), None): Pymatgen Chgcar object,</span>
<span class="sd">            or tuple with object and CoreTaskDoc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: really we want a recommended task_id for charge densities here</span>
        <span class="c1"># this could potentially introduce an ambiguity</span>
        <span class="n">task_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_task_ids_associated_with_material_id</span><span class="p">(</span>
            <span class="n">material_id</span><span class="p">,</span> <span class="n">calc_types</span><span class="o">=</span><span class="p">[</span><span class="n">CalcType</span><span class="o">.</span><span class="n">GGA_Static</span><span class="p">,</span> <span class="n">CalcType</span><span class="o">.</span><span class="n">GGA_U_Static</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CoreTaskDoc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">task_ids</span><span class="o">=</span><span class="n">task_ids</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">,</span> <span class="s2">&quot;task_id&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">latest_doc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">])</span>
        <span class="n">task_id</span> <span class="o">=</span> <span class="n">latest_doc</span><span class="p">[</span><span class="s2">&quot;task_id&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_charge_density_from_task_id</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">inc_task_doc</span><span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_download_info">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_download_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_download_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_ids</span><span class="p">,</span> <span class="n">calc_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of URLs to retrieve raw VASP output files from the NoMaD repository</span>
<span class="sd">        Args:</span>
<span class="sd">            material_ids (list): list of material identifiers (mp-id&#39;s)</span>
<span class="sd">            task_types (list): list of task types to include in download (see CalcType Enum class)</span>
<span class="sd">            file_patterns (list): list of wildcard file names to include for each task</span>
<span class="sd">        Returns:</span>
<span class="sd">            a tuple of 1) a dictionary mapping material_ids to task_ids and</span>
<span class="sd">            calc_types, and 2) a list of URLs to download zip archives from</span>
<span class="sd">            NoMaD repository. Each zip archive will contain a manifest.json with</span>
<span class="sd">            metadata info, e.g. the task/external_ids that belong to a directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># task_id&#39;s correspond to NoMaD external_id&#39;s</span>
        <span class="n">calc_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">calc_types</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CalcType</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">calc_types</span>
            <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">task_ids</span><span class="o">=</span><span class="n">material_ids</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;calc_types&quot;</span><span class="p">,</span> <span class="s2">&quot;deprecated_tasks&quot;</span><span class="p">,</span> <span class="s2">&quot;material_id&quot;</span><span class="p">],</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">calc_type</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;calc_types&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">calc_types</span> <span class="ow">and</span> <span class="n">calc_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">calc_types</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">mp_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">]</span>
                <span class="n">meta</span><span class="p">[</span><span class="n">mp_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span> <span class="s2">&quot;calc_type&quot;</span><span class="p">:</span> <span class="n">calc_type</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">meta</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No tasks found for material id </span><span class="si">{</span><span class="n">material_ids</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># return a list of URLs for NoMaD Downloads containing the list of files</span>
        <span class="c1"># for every external_id in `task_ids`</span>
        <span class="c1"># For reference, please visit https://nomad-lab.eu/prod/rae/api/</span>

        <span class="c1"># check if these task ids exist on NOMAD</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;https://nomad-lab.eu/prod/rae/api/repo/?&quot;</span>
        <span class="k">if</span> <span class="n">file_patterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_pattern</span> <span class="ow">in</span> <span class="n">file_patterns</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;file_pattern=</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
        <span class="n">prefix</span> <span class="o">+=</span> <span class="s2">&quot;external_id=&quot;</span>

        <span class="n">task_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="s2">&quot;task_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">tl</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tl</span><span class="p">]</span>
        <span class="n">nomad_exist_task_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_get_download_info_url_by_task_id</span><span class="p">(</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">task_ids</span><span class="o">=</span><span class="n">task_ids</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nomad_exist_task_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">task_ids</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_help_message</span><span class="p">(</span>
                <span class="n">nomad_exist_task_ids</span><span class="p">,</span> <span class="n">task_ids</span><span class="p">,</span> <span class="n">file_patterns</span><span class="p">,</span> <span class="n">calc_types</span>
            <span class="p">)</span>

        <span class="c1"># generate download links for those that exist</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;https://nomad-lab.eu/prod/rae/api/raw/query?&quot;</span>
        <span class="k">if</span> <span class="n">file_patterns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_pattern</span> <span class="ow">in</span> <span class="n">file_patterns</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;file_pattern=</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
        <span class="n">prefix</span> <span class="o">+=</span> <span class="s2">&quot;external_id=&quot;</span>

        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">tids</span> <span class="k">for</span> <span class="n">tids</span> <span class="ow">in</span> <span class="n">nomad_exist_task_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">meta</span><span class="p">,</span> <span class="n">urls</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_get_download_info_url_by_task_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">task_ids</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">nomad_exist_task_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/raw/query&quot;</span><span class="p">,</span> <span class="s2">&quot;/repo/&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">task_id</span> <span class="ow">in</span> <span class="n">task_ids</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">task_id</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nomad_exist</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
                <span class="n">nomad_exist_task_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nomad_exist_task_ids</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_nomad_exist</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;pagination&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_print_help_message</span><span class="p">(</span><span class="n">nomad_exist_task_ids</span><span class="p">,</span> <span class="n">task_ids</span><span class="p">,</span> <span class="n">file_patterns</span><span class="p">,</span> <span class="n">calc_types</span><span class="p">):</span>
        <span class="n">non_exist_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">nomad_exist_task_ids</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;For file patterns [</span><span class="si">{</span><span class="n">file_patterns</span><span class="si">}</span><span class="s2">] and calc_types [</span><span class="si">{</span><span class="n">calc_types</span><span class="si">}</span><span class="s2">], </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;the following ids are not found on NOMAD [</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">non_exist_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">]. </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;If you need to upload them, please contact Patrick Huck at phuck@lbl.gov&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="MPRester.query">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.query">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The MPRester().query method has been replaced with the MPRester().summary.search method.</span>
<span class="sd">        Note this method also no longer supports direct MongoDB-type queries. For more information,</span>
<span class="sd">        please see the new documentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The MPRester().query method has been replaced with the MPRester().summary.search method.</span>
<span class="sd">            Note this method also no longer supports direct MongoDB-type queries. For more information,</span>
<span class="sd">            please see the new documentation.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MPRester.get_cohesive_energy">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_cohesive_energy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cohesive_energy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">material_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MPID</span> <span class="o">|</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">normalization</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;atom&quot;</span><span class="p">,</span> <span class="s2">&quot;formula_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;atom&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtain the cohesive energy of the structure(s) corresponding to multiple MPIDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_ids ([MPID | str]) : List of MPIDs to compute cohesive energies.</span>
<span class="sd">            normalization (str = &quot;atom&quot; (default) or &quot;formula_unit&quot;) :</span>
<span class="sd">                Whether to normalize the cohesive energy by the number of atoms (default)</span>
<span class="sd">                or by the number of formula units.</span>
<span class="sd">                Note that the current default is inconsistent with the legacy API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict[str,float]) : The cohesive energies (in eV/atom or eV/formula unit) for</span>
<span class="sd">            each material, indexed by MPID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry_preference</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;GGA&quot;</span><span class="p">,</span> <span class="s2">&quot;GGA_U&quot;</span><span class="p">,</span> <span class="s2">&quot;SCAN&quot;</span><span class="p">,</span> <span class="s2">&quot;R2SCAN&quot;</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="n">run_type_to_dfa</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;GGA&quot;</span><span class="p">:</span> <span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="s2">&quot;GGA_U&quot;</span><span class="p">:</span> <span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="s2">&quot;R2SCAN&quot;</span><span class="p">:</span> <span class="s2">&quot;r2SCAN&quot;</span><span class="p">}</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="p">{</span><span class="n">mp_id</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">mp_id</span> <span class="ow">in</span> <span class="n">material_ids</span><span class="p">}</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(</span>
            <span class="n">material_ids</span><span class="p">,</span>
            <span class="n">compatible_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">property_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">conventional_unit_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="s2">&quot;uncorrected_energy_per_atom&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">uncorrected_energy_per_atom</span><span class="p">,</span>
                <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">mp_id</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;material_id&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">run_type</span> <span class="o">:=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;run_type&quot;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">energies</span><span class="p">[</span><span class="n">mp_id</span><span class="p">]:</span>
                <span class="n">energies</span><span class="p">[</span><span class="n">mp_id</span><span class="p">][</span><span class="n">run_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;total_energy_per_atom&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">}</span>

            <span class="c1"># Obtain lowest total energy/atom within a given run type</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;uncorrected_energy_per_atom&quot;</span><span class="p">]</span>
                <span class="o">&lt;</span> <span class="n">energies</span><span class="p">[</span><span class="n">mp_id</span><span class="p">][</span><span class="n">run_type</span><span class="p">][</span><span class="s2">&quot;total_energy_per_atom&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">energies</span><span class="p">[</span><span class="n">mp_id</span><span class="p">][</span><span class="n">run_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;total_energy_per_atom&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;uncorrected_energy_per_atom&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;composition&quot;</span><span class="p">],</span>
                <span class="p">}</span>

        <span class="n">atomic_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_reference_data</span><span class="p">()</span>

        <span class="n">e_coh_per_atom</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mp_id</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">energies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
                <span class="n">e_coh_per_atom</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mp_id</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>
            <span class="c1"># take entry from most reliable and available functional</span>
            <span class="n">prefered_func</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">entry_preference</span><span class="p">[</span><span class="n">k</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">e_coh_per_atom</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mp_id</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cohesive_energy</span><span class="p">(</span>
                <span class="n">entries</span><span class="p">[</span><span class="n">prefered_func</span><span class="p">][</span><span class="s2">&quot;composition&quot;</span><span class="p">],</span>
                <span class="n">entries</span><span class="p">[</span><span class="n">prefered_func</span><span class="p">][</span><span class="s2">&quot;total_energy_per_atom&quot;</span><span class="p">],</span>
                <span class="n">atomic_energies</span><span class="p">[</span><span class="n">run_type_to_dfa</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefered_func</span><span class="p">,</span> <span class="n">prefered_func</span><span class="p">)],</span>
                <span class="n">normalization</span><span class="o">=</span><span class="n">normalization</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">e_coh_per_atom</span></div>


<div class="viewcode-block" id="MPRester.get_atom_reference_data">
<a class="viewcode-back" href="../../../_autosummary/mp_api.client.mprester.MPRester.html#mp_api.client.mprester.MPRester.get_atom_reference_data">[docs]</a>
    <span class="nd">@lru_cache</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_atom_reference_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">funcs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;PBE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SCAN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;r2SCAN&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve energies of isolated neutral atoms from MPContribs.</span>

<span class="sd">        Args:</span>
<span class="sd">            funcs ([str] or None) : list of functionals to retrieve data for.</span>
<span class="sd">            Defaults to all available functionals (&quot;PBE&quot;, &quot;SCAN&quot;, &quot;r2SCAN&quot;)</span>
<span class="sd">            when set to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict[str, dict[str, float]]) : dict containing isolated atom energies,</span>
<span class="sd">            indexed first by the functionals in funcs, and second by the atom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_atomic_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contribs</span><span class="o">.</span><span class="n">query_contributions</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="s2">&quot;isolated_atom_energies&quot;</span><span class="p">},</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;data.</span><span class="si">{</span><span class="n">dfa</span><span class="si">}</span><span class="s2">.energy&quot;</span> <span class="k">for</span> <span class="n">dfa</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">]],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">dfa</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;formula&quot;</span><span class="p">]:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">dfa</span><span class="p">][</span><span class="s2">&quot;energy&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">_atomic_energies</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">dfa</span> <span class="ow">in</span> <span class="n">funcs</span>
        <span class="p">}</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_cohesive_energy</span><span class="p">(</span>
        <span class="n">composition</span><span class="p">:</span> <span class="n">Composition</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">energy_per_atom</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">atomic_energies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">normalization</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;atom&quot;</span><span class="p">,</span> <span class="s2">&quot;formula_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;atom&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtain the cohesive energy of a given composition and energy.</span>

<span class="sd">        Args:</span>
<span class="sd">            composition (Composition or dict) : the composition of the structure.</span>
<span class="sd">            energy_per_atom (float) : the energy per atom of the structure.</span>
<span class="sd">            atomic_energies (dict[str,float]) : a dict containing reference total energies</span>
<span class="sd">                of neutral atoms.</span>
<span class="sd">            normalization (str = &quot;atom&quot; (default) or &quot;formula_unit&quot;) :</span>
<span class="sd">                Whether to normalize the cohesive energy by the number of atoms (default)</span>
<span class="sd">                or by the number of formula units.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float) : the cohesive energy per atom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">composition</span><span class="p">)</span><span class="o">.</span><span class="n">remove_charges</span><span class="p">()</span>
        <span class="n">atomic_energy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">coeff</span> <span class="o">*</span> <span class="n">atomic_energies</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)]</span> <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">natom</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">normalization</span> <span class="o">==</span> <span class="s2">&quot;atom&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">energy_per_atom</span> <span class="o">-</span> <span class="n">atomic_energy</span> <span class="o">/</span> <span class="n">natom</span>
        <span class="k">elif</span> <span class="n">normalization</span> <span class="o">==</span> <span class="s2">&quot;formula_unit&quot;</span><span class="p">:</span>
            <span class="n">num_form_unit</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_reduced_composition_and_factor</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">energy_per_atom</span> <span class="o">*</span> <span class="n">natom</span> <span class="o">-</span> <span class="n">atomic_energy</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_form_unit</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stability</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entries</span><span class="p">:</span> <span class="n">ComputedEntry</span> <span class="o">|</span> <span class="n">ComputedStructureEntry</span> <span class="o">|</span> <span class="n">PDEntry</span><span class="p">,</span>
        <span class="n">thermo_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">ThermoType</span> <span class="o">=</span> <span class="n">ThermoType</span><span class="o">.</span><span class="n">GGA_GGA_U</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">chemsys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">chemsys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="n">chemsys_str</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">chemsys</span><span class="p">))</span>

        <span class="n">thermo_type</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ThermoType</span><span class="p">(</span><span class="n">thermo_type</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thermo_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">thermo_type</span>
        <span class="p">)</span>

        <span class="n">corrector</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">thermo_type</span> <span class="o">==</span> <span class="n">ThermoType</span><span class="o">.</span><span class="n">GGA_GGA_U</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.compatibility</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaterialsProject2020Compatibility</span>

            <span class="n">corrector</span> <span class="o">=</span> <span class="n">MaterialsProject2020Compatibility</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">thermo_type</span> <span class="o">==</span> <span class="n">ThermoType</span><span class="o">.</span><span class="n">GGA_GGA_U_R2SCAN</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.mixing_scheme</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaterialsProjectDFTMixingScheme</span>

            <span class="n">corrector</span> <span class="o">=</span> <span class="n">MaterialsProjectDFTMixingScheme</span><span class="p">(</span><span class="n">run_type_2</span><span class="o">=</span><span class="s2">&quot;r2SCAN&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">get_phase_diagram_from_chemsys</span><span class="p">(</span>
                <span class="n">chemsys_str</span><span class="p">,</span> <span class="n">thermo_type</span><span class="o">=</span><span class="n">thermo_type</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">MPRestError</span><span class="p">:</span>
            <span class="n">pd</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No phase diagram data available for chemical system </span><span class="si">{</span><span class="n">chemsys_str</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;and thermo type </span><span class="si">{</span><span class="n">thermo_type</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">corrector</span><span class="p">:</span>
            <span class="n">corrected_entries</span> <span class="o">=</span> <span class="n">corrector</span><span class="o">.</span><span class="n">process_entries</span><span class="p">(</span><span class="n">entries</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">all_entries</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corrected_entries</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">entries</span><span class="p">,</span> <span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">all_entries</span><span class="p">]</span>

        <span class="n">new_pd</span> <span class="o">=</span> <span class="n">PhaseDiagram</span><span class="p">(</span><span class="n">corrected_entries</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;e_above_hull&quot;</span><span class="p">:</span> <span class="n">new_pd</span><span class="o">.</span><span class="n">get_e_above_hull</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span>
                <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
                <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
                <span class="s2">&quot;entry_id&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;entry_id&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;user-entry-</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_oxygen_evolution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">MPID</span> <span class="o">|</span> <span class="n">AlphaID</span><span class="p">,</span>
        <span class="n">working_ion</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Element</span><span class="p">,</span>
        <span class="n">thermo_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">ThermoType</span> <span class="o">=</span> <span class="n">ThermoType</span><span class="o">.</span><span class="n">GGA_GGA_U</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">working_ion</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="n">working_ion</span><span class="p">)</span>
        <span class="n">formatted_mpid</span> <span class="o">=</span> <span class="n">AlphaID</span><span class="p">(</span><span class="n">material_id</span><span class="p">)</span><span class="o">.</span><span class="n">string</span>
        <span class="n">electrode_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">insertion_electrodes</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">battery_ids</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted_mpid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">working_ion</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;chemsys&quot;</span><span class="p">,</span> <span class="s2">&quot;electrode_object&quot;</span><span class="p">,</span> <span class="s2">&quot;framework&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">electrode_docs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No available insertion electrode data with MPID = &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted_mpid</span><span class="si">}</span><span class="s2"> and working ion </span><span class="si">{</span><span class="n">working_ion</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">Element</span><span class="o">.</span><span class="n">O</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="n">Element</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">electrode_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">chemsys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No oxygen in the host framework </span><span class="si">{</span><span class="n">electrode_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">framework</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">inserted_chemsys</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">({</span><span class="n">working_ion</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">electrode_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">chemsys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)})</span>
        <span class="p">)</span>
        <span class="n">unique_composition</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">composition</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">electrode_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">electrode_object</span><span class="o">.</span><span class="n">get_all_entries</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">phase_diagram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">thermo</span><span class="o">.</span><span class="n">get_phase_diagram_from_chemsys</span><span class="p">(</span>
            <span class="n">inserted_chemsys</span><span class="p">,</span>
            <span class="n">thermo_type</span><span class="o">=</span><span class="n">ThermoType</span><span class="p">(</span><span class="n">thermo_type</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">OxygenEvolution</span><span class="p">()</span><span class="o">.</span><span class="n">get_oxygen_evolution_from_phase_diagram</span><span class="p">(</span>
            <span class="n">phase_diagram</span><span class="p">,</span>
            <span class="n">unique_composition</span><span class="p">,</span>
        <span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">mp-api</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=materialsproject&repo=api&type=star&v=2&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Project Modules</a></li>
</ul>


<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, The Materials Project.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.0.4</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    
    <a href="https://github.com/materialsproject/api" class="github">
        <img src="../../../_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>